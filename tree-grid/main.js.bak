var canvas = document.getElementById('huh');
var ctx = canvas.getContext('2d');

canvas.width = canvas.clientWidth * window.devicePixelRatio;
canvas.height = canvas.clientHeight * window.devicePixelRatio;

function loadImage(src) {
	return new Promise((resolve, reject) => {
		var img = new Image();
		img.src = src;
		img.onload = () => resolve(img);
		img.onerror = reject;
	});
}

function loadAllImages(srcs) {
	return Promise.all(srcs.map(loadImage));
}


// input handlers:
const keyboardState = {};

window.addEventListener('keydown', (e) => {
	keyboardState[e.key] = true;
});

window.addEventListener('keyup', (e) => {
	delete keyboardState[e.key];
});

//const mouseState = {x: 0, y: 0};

//window.addEventListener('mousemove', (e) => {
//	mouseState.x = e.pageX;
//	mouseState.y = e.pageY;
//});

var images = [];

// load:
loadAllImages([]).then(_images => {
	images = _images;

	// start animation:
	tick();
});

var then = performance.now();

function tick() {
	var now = performance.now();
	var dt = (now - then) / 1000; // diff in seconds

	update(dt);
	draw();

	then = now;

	window.requestAnimationFrame(tick); // scheduling next frame
}

var state = {
	rect: { x: 0, y: 0, width: 100, height: 100 }
};

function update(dt) {
	//console.log(keyboardState);
	if (keyboardState["ArrowRight"] == true) {
		state.rect.width += 10;
		console.log(state.rect.width);
	}
	else if (keyboardState["ArrowLeft"] == true) {
		state.rect.width -= 10;
		console.log(state.rect.width);
	}


	if (state.rect.x <= canvas.width) {
		state.rect.x += 100 * dt;
	}
	else {
		state.rect.x = 0;
	}
}

function draw() {
	const width = canvas.width;
	const height = canvas.height;
	ctx.clearRect(0, 0, width, height);

	//var hedgehog = images[0];
	//var turtle = images[1];
//
	//ctx.globalAlpha = 0.5;
//
	//ctx.drawImage(hedgehog, 0, 0);
//
	//ctx.drawImage(turtle, 400, 100);

	ctx.globalAlpha = 1;
	ctx.fillStyle = 'rgb(200, 0, 0)';
	ctx.fillRect(state.rect.x, state.rect.y, state.rect.width, state.rect.height);

	ctx.fillStyle = 'rgba(0, 0, 200, 0.5)';
	ctx.fillRect(30, 30, 50, 50);
}